import{c as S,o as ee,t as C,i as a,a as t,v as K,A as te,F as R,C as le,b as ae,M as k,T as ne,S as j,D as E,E as se,f as ie,j as y,G as re,H as oe,I as ce,J as de,h as he,K as ue,L as ge,N as Ce,O as pe,e as z,p as fe}from"./index-CF6Yk-Rb.js";import{B as $e,o as T}from"./ConfirmModal-TQMJ_Tbz.js";import{c as be,P as ve,s as U}from"./Pagination-CN3GakfK.js";import"./mermaid-BOfcbsIe.js";import"./hljs-nSGkUMep.js";import"./marked-DPzEbV2M.js";var _e=C('<div class="modal is-active"><div class=modal-background></div><div class=modal-content><div class=box><p>Clear all chats except the latest chats</p><div class=field><label class=label>Leave Latest</label><div class=control><input class=input type=number placeholder="Number of items to leave"value=5></div></div><div class=buttons></div></div></div><button class="modal-close is-large"aria-label=close>'),me=C("<span class=spinner>"),xe=C("<b>"),we=C("<i>Untitled"),Se=C('<a><div class=panel-item-content><div class=panel-item-body><div></div></div><div class=panel-item-date><div></div><div></div></div></div><button class="button is-danger is-small"><span class=icon>'),ye=C('<a class="panel-block is-active"><span class=spinner></span> Loading...'),ke=C('<div class=container><div class=m-2><nav class="panel is-primary"><p class="panel-block has-text-weight-bold">Ongoing Chats (<!>)</p></nav><nav class="panel is-primary"><p class="panel-block has-text-weight-bold flex-split"><span>Chats (<!>)</span><button class="button is-small is-primary"><span class="icon mr-1"></span>New Chat</button></p><div class=panel-block><p class=control><input class=input type=text placeholder="Filter by..."></p></div></nav><p class="control is-fullwidth"><button class="button is-danger is-outlined is-fullwidth">Clear All');const Le=e=>{let s;const c=async()=>{let n=parseInt(s.value);isNaN(n)&&(n=0),n=Math.max(0,n),e.onClear(n)};return(()=>{var n=_e(),p=n.firstChild,d=p.nextSibling,f=d.firstChild,r=f.firstChild,u=r.nextSibling,g=u.firstChild,v=g.nextSibling,i=v.firstChild,$=u.nextSibling,m=d.nextSibling,x=s;return typeof x=="function"?z(x,i):s=i,a($,t($e,{autofocus:!0,onEscape:()=>e.onClose(),buttons:[{class:"button is-danger",label:"OK",onClick:()=>c()},{class:"button",label:"Cancel",onClick:()=>e.onClose()}]})),ie(m,"click",e.onClose,!0),n})()},G=e=>{let s="";return oe(e.chat)?s="has-background-warning-soft":ce()._id===e.chat._id&&(s="has-background-info-soft"),(()=>{var c=Se(),n=c.firstChild,p=n.firstChild,d=p.firstChild,f=p.nextSibling,r=f.firstChild,u=r.nextSibling,g=n.nextSibling,v=g.firstChild;return c.$$click=()=>e.onOpen(e.chat._id),de(c,"panel-block panel-item is-active "+s),a(d,t(K,{get when(){return e.progressing},get children(){return me()}}),null),a(d,t(j,{get children(){return[t(k,{get when(){return e.chat.title},get children(){var i=xe();return a(i,()=>e.chat.title),i}}),t(k,{when:!0,get children(){return we()}})]}}),null),a(r,t(he,{}),null),a(r,()=>U(new Date(e.chat.createdAt)),null),a(u,t(ue,{}),null),a(u,()=>U(new Date(e.chat.updatedAt||0)),null),g.$$click=i=>{i.stopPropagation(),e.onDelete(e.chat._id)},a(v,t(ge,{get component(){return e.deleteIcon}})),c})()},Me=()=>{const[e,s]=S(!1),c=10,[n,p]=S(),[d,f]=S([]),[r,u]=be(d,c),[g,v]=S([]);let i;const $=async()=>{const l=E.getOngoings(),o=new Set(l.map(h=>h.meta.id)),A=(await(await se()).getAll()).filter(h=>!o.has(h._id));v(l.sort((h,_)=>(_.ctx.updatedAt||0)-(h.ctx.updatedAt||0))),p(A),x()},m=()=>n().filter(l=>l.title.indexOf(i.value)>=0),x=()=>{f(m().sort((l,o)=>(o.updatedAt||0)-(l.updatedAt||0)))},H=async l=>{const o=d().slice(l).map(b=>b._id);await y.promise(re(o),{loading:"Clearing...",success:"Cleared",error:"Failed to clear"}),$(),s(!1)},J=()=>{f(m())},X=async l=>{await T("Are you sure to unload this chat?")&&(E.unloadChat(l),y.success("Canceled"),$())},q=async l=>{await T("Are you sure to delete this chat?")&&(y.promise(pe(l),{loading:"Deleting...",success:"Deleted",error:"Failed to delete"}),$())},O=async l=>{y.promise(Ce(l),{loading:"Loading...",success:"Loaded",error:"Failed to load"})};return ee(()=>$()),(()=>{var l=ke(),o=l.firstChild,b=o.firstChild,L=b.firstChild,A=L.firstChild,h=A.nextSibling;h.nextSibling;var _=b.nextSibling,F=_.firstChild,D=F.firstChild,Q=D.firstChild,I=Q.nextSibling;I.nextSibling;var M=D.nextSibling,V=M.firstChild,W=F.nextSibling,Y=W.firstChild,P=Y.firstChild,B=_.nextSibling,Z=B.firstChild;a(l,t(K,{get when(){return e()},get children(){return t(Le,{onClose:()=>s(!1),onClear:H})}}),o),a(L,()=>g()?.length||"-",h),a(b,t(R,{get each(){return g()},children:w=>t(G,{get chat(){return w.ctx},get progressing(){return w.progressing},deleteIcon:te,onOpen:O,onDelete:X})}),null),a(D,()=>n()?.length||"-",I),M.$$click=()=>le(),a(V,t(ae,{})),P.$$input=J;var N=i;return typeof N=="function"?z(N,P):i=P,a(_,t(j,{get children(){return[t(k,{get when(){return n()===void 0},get children(){return ye()}}),t(k,{when:!0,get children(){return t(R,{get each(){return r().items},children:w=>t(G,{chat:w,deleteIcon:ne,onOpen:O,onDelete:q})})}})]}}),null),a(o,t(ve,{get currentPage(){return r().page},get totalPages(){return r().totalPages},onPageChange:u}),B),Z.$$click=()=>s(!0),l})()};fe(["click","input"]);export{Me as default};
