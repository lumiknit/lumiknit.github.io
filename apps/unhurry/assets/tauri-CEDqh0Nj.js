import{a0 as v,x as k,a1 as Q}from"./index-CF6Yk-Rb.js";import"./mermaid-BOfcbsIe.js";import"./hljs-nSGkUMep.js";import"./marked-DPzEbV2M.js";const q=new Set(["success","warning","error"]),Z=new Set(["light","medium","heavy","soft","rigid"]);function i(e,t,n,a){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?a:n==="a"?a.call(e):a?a.value:t.get(e)}function w(e,t,n,a,r){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}var p,c,h,_,E;const I="__TAURI_TO_IPC_KEY__";function P(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}class ${constructor(t){p.set(this,void 0),c.set(this,0),h.set(this,[]),_.set(this,void 0),w(this,p,t||(()=>{})),this.id=P(n=>{const a=n.index;if("end"in n){a==i(this,c,"f")?this.cleanupCallback():w(this,_,a);return}const r=n.message;if(a==i(this,c,"f")){for(i(this,p,"f").call(this,r),w(this,c,i(this,c,"f")+1);i(this,c,"f")in i(this,h,"f");){const o=i(this,h,"f")[i(this,c,"f")];i(this,p,"f").call(this,o),delete i(this,h,"f")[i(this,c,"f")],w(this,c,i(this,c,"f")+1)}i(this,c,"f")===i(this,_,"f")&&this.cleanupCallback()}else i(this,h,"f")[a]=r})}cleanupCallback(){Reflect.deleteProperty(window,`_${this.id}`)}set onmessage(t){w(this,p,t)}get onmessage(){return i(this,p,"f")}[(p=new WeakMap,c=new WeakMap,h=new WeakMap,_=new WeakMap,I)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[I]()}}async function s(e,t={},n){return window.__TAURI_INTERNALS__.invoke(e,t,n)}class J{get rid(){return i(this,E,"f")}constructor(t){E.set(this,void 0),w(this,E,t)}async close(){return s("plugin:resources|close",{rid:this.rid})}}E=new WeakMap;var L;(function(e){e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_CREATED="tauri://window-created",e.WEBVIEW_CREATED="tauri://webview-created",e.DRAG_ENTER="tauri://drag-enter",e.DRAG_OVER="tauri://drag-over",e.DRAG_DROP="tauri://drag-drop",e.DRAG_LEAVE="tauri://drag-leave"})(L||(L={}));async function Y(e,t){await s("plugin:event|unlisten",{event:e,eventId:t})}async function K(e,t,n){var a;const r=(a=void 0)!==null&&a!==void 0?a:{kind:"Any"};return s("plugin:event|listen",{event:e,target:r,handler:P(t)}).then(o=>async()=>Y(e,o))}var A;(function(e){e.QRCode="QR_CODE",e.UPC_A="UPC_A",e.UPC_E="UPC_E",e.EAN8="EAN_8",e.EAN13="EAN_13",e.Code39="CODE_39",e.Code93="CODE_93",e.Code128="CODE_128",e.Codabar="CODABAR",e.ITF="ITF",e.Aztec="AZTEC",e.DataMatrix="DATA_MATRIX",e.PDF417="PDF_417"})(A||(A={}));async function X(e){return await s("plugin:barcode-scanner|scan",{...e})}async function B(e={}){return typeof e=="object"&&Object.freeze(e),await s("plugin:dialog|open",{options:e})}async function ee(e={}){return typeof e=="object"&&Object.freeze(e),await s("plugin:dialog|save",{options:e})}var O;(function(e){e[e.Audio=1]="Audio",e[e.Cache=2]="Cache",e[e.Config=3]="Config",e[e.Data=4]="Data",e[e.LocalData=5]="LocalData",e[e.Document=6]="Document",e[e.Download=7]="Download",e[e.Picture=8]="Picture",e[e.Public=9]="Public",e[e.Video=10]="Video",e[e.Resource=11]="Resource",e[e.Temp=12]="Temp",e[e.AppConfig=13]="AppConfig",e[e.AppData=14]="AppData",e[e.AppLocalData=15]="AppLocalData",e[e.AppCache=16]="AppCache",e[e.AppLog=17]="AppLog",e[e.Desktop=18]="Desktop",e[e.Executable=19]="Executable",e[e.Font=20]="Font",e[e.Home=21]="Home",e[e.Runtime=22]="Runtime",e[e.Template=23]="Template"})(O||(O={}));var U;(function(e){e[e.Start=0]="Start",e[e.Current=1]="Current",e[e.End=2]="End"})(U||(U={}));function te(e){return{isFile:e.isFile,isDirectory:e.isDirectory,isSymlink:e.isSymlink,size:e.size,mtime:e.mtime!==null?new Date(e.mtime):null,atime:e.atime!==null?new Date(e.atime):null,birthtime:e.birthtime!==null?new Date(e.birthtime):null,readonly:e.readonly,fileAttributes:e.fileAttributes,dev:e.dev,ino:e.ino,mode:e.mode,nlink:e.nlink,uid:e.uid,gid:e.gid,rdev:e.rdev,blksize:e.blksize,blocks:e.blocks}}function ne(e){const t=new Uint8ClampedArray(e),n=t.byteLength;let a=0;for(let r=0;r<n;r++){const o=t[r];a*=256,a+=o}return a}class ae extends J{async read(t){if(t.byteLength===0)return 0;const n=await s("plugin:fs|read",{rid:this.rid,len:t.byteLength}),a=ne(n.slice(-8)),r=n instanceof ArrayBuffer?new Uint8Array(n):n;return t.set(r.slice(0,r.length-8)),a===0?null:a}async seek(t,n){return await s("plugin:fs|seek",{rid:this.rid,offset:t,whence:n})}async stat(){const t=await s("plugin:fs|fstat",{rid:this.rid});return te(t)}async truncate(t){await s("plugin:fs|ftruncate",{rid:this.rid,len:t})}async write(t){return await s("plugin:fs|write",{rid:this.rid,data:t})}}async function se(e,t){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const n=await s("plugin:fs|open",{path:e instanceof URL?e.toString():e,options:t});return new ae(n)}async function N(e,t){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");const n=await s("plugin:fs|read_file",{path:e instanceof URL?e.toString():e,options:t});return n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n)}async function re(e,t,n){if(e instanceof URL&&e.protocol!=="file:")throw new TypeError("Must be a file URL.");if(t instanceof ReadableStream){const a=await se(e,n),r=t.getReader();try{for(;;){const{done:o,value:f}=await r.read();if(o)break;await a.write(f)}}finally{r.releaseLock(),await a.close()}}else await s("plugin:fs|write_file",t,{headers:{path:encodeURIComponent(e instanceof URL?e.toString():e),options:JSON.stringify(n)}})}const ie={async vibrate(e){try{return{status:"ok",data:await s("plugin:haptics|vibrate",{duration:e})}}catch(t){if(t instanceof Error)throw t;return{status:"error",error:t}}},async impactFeedback(e){try{return{status:"ok",data:await s("plugin:haptics|impact_feedback",{style:e})}}catch(t){if(t instanceof Error)throw t;return{status:"error",error:t}}},async notificationFeedback(e){try{return{status:"ok",data:await s("plugin:haptics|notification_feedback",{type:e})}}catch(t){if(t instanceof Error)throw t;return{status:"error",error:t}}}},{vibrate:oe,impactFeedback:ce,notificationFeedback:le}=ie,b="Request cancelled";async function ue(e,t){const n=t?.signal;if(n?.aborted)throw new Error(b);const a=t?.maxRedirections,r=t?.connectTimeout,o=t?.proxy,f=t?.danger;t&&(delete t.maxRedirections,delete t.connectTimeout,delete t.proxy,delete t.danger);const l=t?.headers?t.headers instanceof Headers?t.headers:new Headers(t.headers):new Headers,g=new Request(e,t),C=await g.arrayBuffer(),W=C.byteLength!==0?Array.from(new Uint8Array(C)):null;for(const[u,d]of g.headers)l.get(u)||l.set(u,d);const x=(l instanceof Headers?Array.from(l.entries()):Array.isArray(l)?l:Object.entries(l)).map(([u,d])=>[u,typeof d=="string"?d:d.toString()]);if(n?.aborted)throw new Error(b);const S=await s("plugin:http|fetch",{clientConfig:{method:g.method,url:g.url,headers:x,data:W,maxRedirections:a,connectTimeout:r,proxy:o,danger:f}}),T=()=>s("plugin:http|fetch_cancel",{rid:S});if(n?.aborted)throw T(),new Error(b);n?.addEventListener("abort",()=>void T());const{status:z,statusText:F,url:H,headers:M,rid:D}=await s("plugin:http|fetch_send",{rid:S}),G=new ReadableStream({start:u=>{const d=new $;d.onmessage=R=>{if(n?.aborted){u.error(b);return}const m=new Uint8Array(R),V=m[m.byteLength-1],j=m.slice(0,m.byteLength-1);if(V==1){u.close();return}u.enqueue(j)},s("plugin:http|fetch_read_body",{rid:D,streamChannel:d}).catch(R=>{u.error(R)})}}),y=new Response(G,{status:z,statusText:F});return Object.defineProperty(y,"url",{value:H}),Object.defineProperty(y,"headers",{value:new Headers(M)}),y}class me{constructor(){}name(){return"Tauri"}fetch=async(t,n)=>(n===void 0&&(n={}),n.headers=new Headers(n.headers),n.headers.set("Origin",""),await ue(t,n));async myIP(){const t=await s("self_ip",{format:"qr_svg"});if(t.error)throw new Error(t.error);return t}async genQRSVG(t){console.log("genQRSVG",t);const n=await s("string_to_qr_svg",{input:t});if(console.log("genQRSVG result",n),n.error)throw new Error(n.error);return n}async scanQRCode(){return(await X({windowed:!1,cameraDirection:"back",formats:[A.QRCode]})).content}async vibrate(t){typeof t=="number"?oe(t):q.has(t)?le(t):Z.has(t)&&ce(t)}unlistens=[];async mountDragAndDrop(t){this.unlistens.push(await K("tauri://drag-drop",async n=>{const a=await Promise.all(n.payload.paths.map(async r=>{const o=await N(r),f=v(r),l=k(r);return{uri:"file://"+r,name:f,mimeType:l,data:o}}));t(a)}))}async unmountDragAndDrop(){for(const t of this.unlistens)t();this.unlistens=[]}async uploadFiles(){const t=await B({multiple:!0});if(t===null)throw new Error("User canceled the file open dialog");return await Promise.all(t.map(async a=>{const r=await N(a),o=v(a),f=k(a);return{uri:"file://"+a,name:o,mimeType:f,data:r}}))}async downloadFile(t,n){const a=await ee({defaultPath:t,canCreateDirectories:!0});if(a===null)throw new Error("User canceled the file save dialog");const r=new Uint8Array(await n.arrayBuffer());await re(a,r)}async speechRecognizer(){return await this.speechRecogSupported()?new de:(console.warn("Speech Recognition Plugin not availble, use fallback"),new Q)}async speechRecogSupported(){return(await s("plugin:speech-recog|is_supported",{payload:{}})).supported}}class de{recognizing=!1;languages=[];onError;onTranscript;onStopped;stateInterval=0;lastEventMS=0;lastTranscript="";async start(){if(this.recognizing)return!1;this.recognizing=!0,this.lastEventMS=0,this.lastTranscript="",this.stateInterval=window.setInterval(()=>this.handleGetState(),200);const t=await s("plugin:speech-recog|start_recognition",{payload:{languages:[]}});if(!t.success)throw new Error(t.error);return t.success}async stop(){const t=await s("plugin:speech-recog|stop_recognition",{payload:{}});if(!t.success)throw new Error(t.error);return this.cleanup(),t.success}async cleanup(){this.recognizing=!1,window.clearInterval(this.stateInterval),this.stateInterval=0}async handleGetState(){const t=await s("plugin:speech-recog|get_state",{payload:{}});if(!t.recognizing){this.onStopped?.(),this.cleanup();return}if(t.timestampMs>this.lastEventMS){this.lastEventMS=t.timestampMs;const n=t.partialText==="",a=t.completedText+t.partialText;this.onTranscript?.(a,n,this.lastTranscript),this.lastTranscript=t.partialText}t.error&&this.onError?.(t.error)}}export{me as TauriService,de as TauriSpeechRecognizer};
