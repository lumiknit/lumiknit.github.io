<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="./favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Inf MineSweeoer" />
    <link rel="manifest" href="./site.webmanifest" />
    <title>Inf Minesweeper</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const F=e=>{throw alert(e),new Error(e)},w=document.getElementsByClassName("top")[0],H=e=>{const t=document.getElementById(e);t||F(`Canvas element with id "${e}" not found.`);const n=t.getContext("2d");return n||F("2D context not supported."),n},T=["canvas-1","canvas-2"].map(H);let S=0;const l=()=>T[S],N=()=>T[1-S],b=()=>{l().canvas.style.visibility="visible",N().canvas.style.visibility="hidden",S=1-S},A=(e,t)=>{T.forEach(n=>{n.canvas.width=e*window.devicePixelRatio,n.canvas.height=t*window.devicePixelRatio})};let y=null;window.addEventListener("resize",()=>{y&&clearTimeout(y),y=window.setTimeout(()=>{A(window.innerWidth,window.innerHeight),y=null},100)});A(window.innerWidth,window.innerHeight);let c=[],f=0,v=!1,x=null;const j=()=>{const e=localStorage.getItem("hiscore"),t=parseInt(e||"");return isNaN(t)?0:t},W=e=>{localStorage.setItem("hiscore",e.toString())};let p=j();const h=12,C=e=>{const i=.035*Math.sin(e/40),s=.1+(.35-.1)*Math.min(e/2e3,1)+i;return console.log("Dense",s,i),s},Y=e=>new Array(h).fill(null).map(()=>({mine:Math.random()<e,state:"hidden",cnt:0})),R=(e,t,n)=>{for(let o=-1;o<=1;o++){const i=e+o;if(!(i<0||i>=h))for(let s=-1;s<=1;s++){const a=t+s;a<0||a>=c.length||n(c[a][i],i,a)}}},k=(e,t)=>{for(let n=Math.max(0,e);n<t&&n<c.length;n++)for(let o=0;o<h;o++){let i=0;R(o,n,s=>{s.mine&&i++}),c[n][o].cnt=i}for(let n=Math.max(1,e);n<t&&n<c.length;n++)for(let o=0;o<h;o++)!c[n][o].mine&&c[n-1][o].state==="opened"&&c[n-1][o].cnt===0&&D(o,n)},z=(e,t)=>{var o;if(e<0||e>=h||t<0||t>=c.length)return!1;const n=c[t][e];if(n.state==="opened")return!1;if(n.state="opened",n.mine)return v=!0,(o=navigator.vibrate)==null||o.call(navigator,200),!0;if(n.cnt===0)for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++)z(e+i,t+s);return!1},D=(e,t)=>{if(e<0||e>=h||t<0||t>=c.length)return!1;const n=c[t][e];if(n.state==="hidden")return console.log("open",e,t),z(e,t);if(n.state==="opened"&&n.cnt>0){let o=0;if(R(e,t,i=>{i.state==="flagged"&&o++}),o===n.cnt){let i=!1;return R(e,t,(s,a,m)=>{s.state==="hidden"&&z(a,m)&&(i=!0)}),i}}return!1},X=()=>{for(;f<c.length;){let e=!0;const t=c[f];for(let n=0;n<h;n++)if(!!t[n].mine!=(t[n].state==="flagged")){e=!1;break}if(e){f++,f>p&&(p=f,W(p));const n=Math.floor(l().canvas.height/(r.cellSize+r.gap)),o=(f-n/2)*(r.cellSize+r.gap);d.y<o&&(g.y=o)}else break}c.length-f<20&&M(20,C),console.log("cleared",f)},B=(e,t)=>{if(e<0||e>=h||t<0||t>=c.length)return;const n=c[t][e];n.state!=="opened"&&(n.state=n.state==="flagged"?"hidden":"flagged",X())},M=(e,t)=>{const n=c.length-1;for(let o=0;o<e;o++)c.push(Y(t(c.length)));k(n-1,c.length)},q=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),G=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),I=(e,t)=>({x:e.x*t,y:e.y*t}),K=e=>Math.hypot(e.x,e.y),_=(e,t)=>(t.x<e.x&&e.x<t.x+t.w||t.x<e.x+e.w&&e.x+e.w<t.x+t.w||e.x<t.x&&t.x<e.x+e.w||e.x<t.x+t.w&&t.x+t.w<e.x+e.w)&&(t.y<e.y&&e.y<t.y+t.h||t.y<e.y+e.h&&e.y+e.h<t.y+t.h||e.y<t.y&&t.y<e.y+e.h||e.y<t.y+t.h&&t.y+t.h<e.y+e.h);let d={x:0,y:0},g={x:0,y:-200};const J=.005,E=e=>{const t=c.length*(e.cellSize+e.gap),n=h*(e.cellSize+e.gap);return{x:(l().canvas.width-n)/2,y:0,w:n,h:t}},Q=()=>{let e=0;const t=(n,o,i,s,a)=>{l().fillStyle=a,l().font=`${o?"bold ":""}${window.devicePixelRatio*n}px Pretendard`,l().textBaseline="bottom",e-=s*window.devicePixelRatio,l().textAlign="center",l().fillText(i,l().canvas.width/2,e-d.y),e-=window.devicePixelRatio*n};t(14,!1,"lumiknit (aasr4r4@gmail.com)",4,"#E1E3E4"),t(48,!0,"무한 지뢰찾기",4,"#E1E3E4"),t(25,!0,"Infinite MineSweeper",4,"#E1E3E4"),t(16,!1,`Hi-Score: ${p}m`,4,"#E1E3E4")},U=()=>{let e=l().canvas.height/2+96;const t=(n,o,i,s,a)=>{l().fillStyle="#000000a0",l().fillRect(0,e-(s+n)*window.devicePixelRatio,l().canvas.width,(s+n)*window.devicePixelRatio),l().fillStyle=a,l().font=`${o?"bold ":""}${window.devicePixelRatio*n}px Pretendard`,l().textBaseline="bottom",e-=s*window.devicePixelRatio,l().textAlign="center",l().fillText(i,l().canvas.width/2,e),e-=window.devicePixelRatio*n};t(24,!1,"Click to Restart",4,"#FF0000"),t(24,!1,`Hi-Score: ${p}m`,4,"#FF0000"),t(24,!1,`Score: ${f}m`,4,"#FF0000"),t(48,!0,"You Died",4,"#FF0000")};v=!0;const V=["#E1E3E4","#72CCE8","#9DD274","#FF6578","#F69C5E","#FFAD7E","#EACB64","#BA9CF3","#E1E3E4"],Z=(e,t)=>{switch(l().fillStyle=e.state==="opened"?"#828A9A":"#373C4B",l().fillRect(0,0,t.cellSize,t.cellSize),e.state){case"flagged":l().fillStyle="#72CCE8",l().fillRect(0,0,t.cellSize,t.cellSize);break;case"hidden":l().fillStyle="#3D4455",l().fillRect(0,0,t.cellSize,t.cellSize);break;case"opened":e.mine?(l().fillStyle="#FF6578",l().fillRect(0,0,t.cellSize,t.cellSize)):e.cnt>0&&(l().fillStyle=V[e.cnt]||"#E1E3E4",l().fillText(e.cnt.toString(),t.cellSize/2,t.cellSize/2));break}},ee=(e,t)=>{const n=E(t),o={x:0,y:0,w:l().canvas.width,h:l().canvas.height};l().font=`bold ${t.cellSize*.6}px Pretendard`,l().textAlign="center",l().textBaseline="middle";for(let i=0;i<e.length;i++)for(let s=0;s<h;s++){const a=e[i][s],m={x:n.x+s*(t.cellSize+t.gap)-d.x,y:n.y+i*(t.cellSize+t.gap)-d.y};_({...m,w:t.cellSize,h:t.cellSize},o)&&(l().save(),l().translate(m.x,m.y),Z(a,t),l().restore())}if(l().fillStyle="#9DD274",l().fillRect(0,n.y+f*(t.cellSize+t.gap)-d.y-2,l().canvas.width,2),l().font=`italic ${24*window.devicePixelRatio}px Pretendard`,l().textBaseline="bottom",l().textAlign="right",l().save(),l().translate(l().canvas.width-r.gutter,-8+f*(t.cellSize+t.gap)-d.y),l().rotate(Math.PI/2),l().fillText(`${f}m`,0,0),l().restore(),x!==null){const i=(Date.now()-x)/1e3,a=(f/i).toFixed(2);l().save(),l().translate(r.gutter,8+n.y+f*(t.cellSize+t.gap)-d.y),l().rotate(-Math.PI/2),l().fillText(`${a}m/s`,0,0)}l().restore()};let L=Date.now(),r={cellSize:32,gap:2,gutter:16};const u=new Map,P=e=>({x:e.clientX*window.devicePixelRatio,y:e.clientY*window.devicePixelRatio});w.addEventListener("wheel",e=>{g.y+=e.deltaY*2,e.preventDefault()});w.addEventListener("pointerdown",e=>{console.log("down",e.pointerId);const t=E(r);let n=e.clientX*window.devicePixelRatio-t.x+d.x,o=e.clientY*window.devicePixelRatio-t.y+d.y;n=Math.floor(n/(r.cellSize+r.gap)),o=Math.floor(o/(r.cellSize+r.gap)),u.set(e.pointerId,{startPos:P(e),started:e.timeStamp,lastPos:P(e),longTouchTimeout:window.setTimeout(()=>{var i;u.has(e.pointerId)&&(x===null&&(x=Date.now()),B(n,o),(i=navigator.vibrate)==null||i.call(navigator,10),u.delete(e.pointerId))},300)}),w.setPointerCapture(e.pointerId),e.preventDefault()});w.addEventListener("contextmenu",e=>{e.preventDefault()});w.addEventListener("pointermove",e=>{const t=u.get(e.pointerId);if(!t)return;const n=P(e),o=K(G(t.startPos,n));if(t.scrolled||o>10){const i=P(e);d.y-=i.y-t.lastPos.y,g={...d},t.lastPos=i,t.scrolled=e.timeStamp,clearTimeout(t.longTouchTimeout)}e.preventDefault()});w.addEventListener("pointerup",e=>{console.log("up",e.pointerId);const t=u.get(e.pointerId);if(t){if(t.scrolled===void 0)if(clearTimeout(t.longTouchTimeout),v)$();else{let n=E(r),o=e.clientX*window.devicePixelRatio-n.x+d.x,i=e.clientY*window.devicePixelRatio-n.y+d.y;o=Math.floor(o/(r.cellSize+r.gap)),i=Math.floor(i/(r.cellSize+r.gap)),console.log(o,i),x===null&&(x=Date.now()),e.pointerType==="mouse"&&e.button===2||e.pointerType!=="mouse"&&e.timeStamp-t.started>500?B(o,i):D(o,i)}u.delete(e.pointerId),e.preventDefault()}});w.addEventListener("pointercancel",e=>{console.log("cancel",e);const t=u.get(e.pointerId);t&&(clearTimeout(t.longTouchTimeout),u.delete(e.pointerId))});const $=()=>{v=!1,c=[],f=0,x=null,M(10,C),d={x:0,y:-320},g={...d};for(let e=0;e<h;e++)c[0][e].mine||D(e,0)};$();const O=async()=>{const e=(Date.now()-L)*.001;L=Date.now();const t=Math.min(l().canvas.width,l().canvas.height);r.gutter=window.devicePixelRatio*32;const n=Math.floor((t-2*r.gutter)/h);r.cellSize=Math.floor(n-2),r.gap=2;const o=Math.pow(J,e);d=q(I(d,o),I(g,1-o)),g.y<-512&&(g.y=-512);const i=E(r),s=10;if(i.h-d.y<l().canvas.height+(r.cellSize+r.gap)*s){const a=Math.ceil((l().canvas.height+(r.cellSize+r.gap)*s-i.h+d.y)/(r.cellSize+r.gap));M(a,C),console.log("Lines:",c.length)}l().clearRect(0,0,l().canvas.width,l().canvas.height),ee(c,r),d.y<0&&Q(),v&&U(),b(),requestAnimationFrame(O)};O();</script>
    <style rel="stylesheet" crossorigin>@font-face{font-family:Pretendard;font-weight:45 920;font-style:normal;font-display:swap;src:url(./PretendardVariable.woff2) format("woff2-variations")}*{overscroll-behavior:none;touch-action:pinch-zoom}body,:root{top:0;right:0;bottom:0;left:0;margin:0;padding:0;font-family:Pretendard,sans-serif;color:#fff;background-color:#2a2f38}div.top{position:absolute;top:0;right:0;bottom:0;left:0}div.top>canvas{position:absolute;width:100%;height:100%}</style>
  </head>
  <body>
    <div class="top">
      <canvas id="canvas-1"></canvas>
      <canvas id="canvas-2"></canvas>
    </div>
  </body>
</html>
